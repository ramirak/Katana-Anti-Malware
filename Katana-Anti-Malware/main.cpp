#include "KatanaAntiMalware.h"
#include <QtWidgets/QApplication>
#include <windows.h>
#include "Security/Whitelisting.h"
#include "Events/MonitorRoutine.h"
#include "Security/SelfProtection.h"
#include <thread>

// Set console for debugging
void CreateConsole()
{
    FILE* fp;
    AllocConsole();
    freopen_s(&fp, "CONIN$", "r", stdin);
    freopen_s(&fp, "CONOUT$", "w", stdout);
    freopen_s(&fp, "CONOUT$", "w", stderr);
}

int main(int argc, char *argv[])
{
    QGuiApplication::setQuitOnLastWindowClosed(FALSE);
    CreateConsole();
    try
    {
        ReloadList();
    }
    catch (const std::exception& ex)
    {
        cerr << ex.what() << endl;
    }

    std::thread th(InitMonitoring);
    th.detach();

    QApplication a(argc, argv);
    KatanaAntiMalware w;
    w.show();
    return a.exec();
}

